#include "../stdafx.h"
#include "LoadingScene.h"
#include "TitleScene.h"
#include "MapToolScene.h"
#include "testScene.h"

void LoadingScene::Init()
{
	//▼로딩클래스 뉴할당 해주고 초기화
	_loading = new Loading;
	_loading->Init();

	//▼이미지 사운드 씬 로딩
	this->LoadingImage();
	this->LoadingSound();
	this->LoadScenes();

}

void LoadingScene::Release()
{
	//로딩클래스 뉴할당 해준적 있으니 해제
	_loading->Release();
	SAFE_DELETE(_loading);
}

//▼업데이트 한번에 하나의 아이템 로딩함. 로딩서 움직이는 이미지 추가해줘도 되고, 로딩씬서 해줘도 되고.
void LoadingScene::Update()
{
	_loading->Update(); //로딩클래스 애들 업데이트

	if (_loading->LoadingDone()) //이프 조건문을 확인하는 동시에 그 아래 있는 함수들까지 실행됨
	{
		//▼로딩이 끝나고 이동할 씬
		SCENEMANAGER->LoadScene("TitleScene");
	}
}

//▼퍼센테이지 화면에 그려줌. 
void LoadingScene::Render()
{
	float num = _loading->GetLoadItem().size();
	float cur = _loading->GetCurrentGauge();
	per = cur / num * 100;

	std::wstring str = std::to_wstring(per);
	str += L" %";
	D2DRENDERER->RenderText(WINSIZEX/2, WINSIZEY/2, (std::wstring)str, str.size(), D2DRenderer::DefaultBrush::White);

}

//▼원래 사용하던 이미지 로딩방법
void LoadingScene::LoadingImage()
{
	//▼프레임, 일반 이미지 로딩 예시
	//_loading->LoadFrameImage("NPC-상인", L"image/NPC/NPC-상인 할아버지_12장.bmp",12, 1);
	//_loading->LoadImg("이펙트-말풍선", L"image/NPC/이펙트 - 하이.bmp");

	//▼맵툴용
	_loading->LoadImg("MapToolBg1", L"IMAGE/MapToolScene/MapToolBg1.png");
	_loading->LoadImg("MapToolBg2", L"IMAGE/MapToolScene/MapToolBg2.png");
	_loading->LoadImg("MapToolTitle", L"IMAGE/MapToolScene/MaptoolTitle.png");
	_loading->LoadImg("MapToolMapbox", L"IMAGE/MapToolScene/MaptoolMapbox.png");
	_loading->LoadImg("MapToolMat2", L"IMAGE/MapToolScene/MaptoolMat2.png");
	_loading->LoadImg("oldpaper", L"IMAGE/MapToolScene/oldpaper.png");
	
	//▼타이틀용
	_loading->LoadImg("타이틀백그라운드", L"IMAGE/TitleScene/TitleBackground.png");
	_loading->LoadImg("타이틀선택박스", L"IMAGE/TitleScene/TitlePick.png");
	_loading->LoadImg("타이틀텍스트", L"IMAGE/TitleScene/TitleLogo.png");
	_loading->LoadFrameImage("타이틀팔시온", L"IMAGE/TitleScene/TitleFalchion.png", 34, 1);



	//▼작동테스트
	for (int i = 0; i < 100; i++)
	{
		_loading->LoadImg("oldpaper", L"IMAGE/MapToolScene/oldpaper.png");
	}
}

//▼원래 사용하던 로딩방법
void LoadingScene::LoadingSound()
{
	//▼백그라운드 사운드 로딩 예시
	//_loading->LoadSound("시네마틱", "SOUND/Intro_Cinematic.ogg", true, true);

	//▼효과음 로딩 예시
	//_loading->LoadSound("구출", "SOUND/villager_save.ogg", false, false);



	//▼맵툴용
	_loading->LoadSound("맵툴BGM", "SOUND/FE/MapTool_Road Taken.mp3", true, true);
	//▼타이틀용
	_loading->LoadSound("타이틀BGM", "SOUND/FE/TitleBgm.mp3", true, true);
}

//▼로딩방법
void LoadingScene::LoadScenes()
{
	_loading->LoadScene("TitleScene",new TitleScene);
	_loading->LoadScene("MapToolScene", new MapToolScene);
	_loading->LoadScene("test", new testScene);
}
